/**
 * ××¡×˜×¨×˜×’×™×”: ×§×™×–×•×– ×”×¤×¡×“×™ ×”×•×Ÿ (×ž×’×Ÿ ×ž×¡)
 *
 * ×ª× ××™: ×™×© ×”×©×§×¢×•×ª ×‘×©×•×§ ×”×”×•×Ÿ, ×¡×•×£ ×©× ×” (× ×•×‘-×“×¦)
 * ×§×˜×’×•×¨×™×”: strategy
 *
 * ×”×¢×¨×”: ×ž×›×™×•×•×Ÿ ×©××™×Ÿ ×œ× ×• × ×ª×•× ×™ ×¨×•×•×—/×”×¤×¡×“ ×œ× ×ž×ž×•×ž×©×™×,
 * ×”×”×ž×œ×¦×” ×ž×•×¦×’×ª ×œ×›×œ ×ž×™ ×©×™×© ×œ×• ×”×©×§×¢×•×ª ×‘×¡×•×£ ×”×©× ×”
 */

import { createRule } from '../../ruleFactory';
import {
  getInvestmentAssets,
  getCurrentMonth,
} from '../../helpers';

export default createRule({
  id: 'tax-loss-harvesting',
  name: '×§×™×–×•×– ×”×¤×¡×“×™ ×”×•×Ÿ',

  condition: (ctx) => {
    // ×™×© ×”×©×§×¢×•×ª ×‘×©×•×§ ×”×”×•×Ÿ
    if (getInvestmentAssets(ctx) < 50000) return false;

    // × ×•×‘×ž×‘×¨ ××• ×“×¦×ž×‘×¨
    if (getCurrentMonth() < 11) return false;

    return true;
  },

  recommendation: {
    title: '×§×™×–×•×– ×”×¤×¡×“×™ ×”×•×Ÿ (×ž×’×Ÿ ×ž×¡)',
    description: `×× ×™×© ×œ×š × ×™×™×¨×•×ª ×¢×¨×š ×‘×”×¤×¡×“ ×•×ž×™×ž×©×ª ×¨×•×•×—×™× ×”×©× ×”, ×ž×›×™×¨×ª ×”× ×™×™×¨×•×ª ×”×ž×•×¤×¡×“×™× ×œ×¤× ×™ ×”-31 ×‘×“×¦×ž×‘×¨ ×ª××¤×©×¨ ×œ×š ×œ×§×–×– ××ª ×”×”×¤×¡×“ ×ž×•×œ ×”×¨×•×•×— ×•×œ×§×‘×œ ×”×—×–×¨ ×ž×¡ ×©×œ ×›-25% ×¢×œ ×”×”×¤×¡×“.

ðŸ“Š ××™×š ×–×” ×¢×•×‘×“:
â€¢ ×ž×›×¨×ª ×ž× ×™×” ×‘×¨×•×•×— ×©×œ 10,000â‚ª â†’ ×©×™×œ×ž×ª 2,500â‚ª ×ž×¡
â€¢ ×ž×•×›×¨ ×ž× ×™×” ××—×¨×ª ×‘×”×¤×¡×“ ×©×œ 10,000â‚ª
â€¢ ×ž×§×–×– ××ª ×”×”×¤×¡×“ ×ž×•×œ ×”×¨×•×•×— â†’ ×ž×§×‘×œ 2,500â‚ª ×—×–×¨×”!

âš ï¸ ×›×œ×œ×™× ×—×©×•×‘×™×:
â€¢ ×”×§×™×–×•×– ××¤×©×¨×™ ×¨×§ ×‘××•×ª×” ×©× ×ª ×ž×¡
â€¢ ×œ× × ×™×ª×Ÿ ×œ×§× ×•×ª ×—×–×¨×” ××ª ××•×ª×• × ×™×™×¨ ×¢×¨×š ×ž×™×“ (wash sale)
â€¢ ×”×¤×¡×“×™× × ×™×ª×Ÿ ×œ×”×¢×‘×™×¨ ×œ×©× ×™× ×”×‘××•×ª

ðŸ“‹ ×ž×” ×œ×‘×“×•×§:
â€¢ ×”×× ×™×© × ×™×™×¨×•×ª ×¢×¨×š ×‘×ª×™×§ ×©×‘×”×¤×¡×“?
â€¢ ×”×× ×ž×™×ž×©×ª ×¨×•×•×—×™× ×”×©× ×”?
â€¢ ×©×•×•×” ×œ×ž×›×•×¨ ×•×œ×§× ×•×ª × ×™×™×¨ ×“×•×ž×” (×œ× ×–×”×”)`,
    type: 'tax_benefit',
    priority: 'medium',
    category: 'strategy',
    actionUrl: 'https://www.kolzchut.org.il/he/×§×™×–×•×–_×”×¤×¡×“_×”×•×Ÿ_×ž×ž×¡_×¨×•×•×—×™_×”×•×Ÿ',
    potentialValue: undefined,
  },

  getEligibilityReason: (ctx) => {
    const investments = getInvestmentAssets(ctx).toLocaleString('he-IL');
    const month = getCurrentMonth();
    const monthName = month === 11 ? '× ×•×‘×ž×‘×¨' : '×“×¦×ž×‘×¨';
    return `×”×©×§×¢×•×ª ×‘×©×•×•×™ ${investments}â‚ª, ×—×•×“×© ${monthName} - ×–×ž×Ÿ ×œ×‘×“×•×§ ×”×–×“×ž× ×•×™×•×ª ×œ×§×™×–×•×– ×ž×¡`;
  },
});
